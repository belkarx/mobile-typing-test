const arr = [
  "able",
"also",
"area",
"atom",
"baby",
"back",
"ball",
"band",
"bank",
"base",
"bear",
"beat",
"been",
"bell",
"best",
"bird",
"blow",
"blue",
"boat",
"body",
"bone",
"book",
"born",
"both",
"burn",
"busy",
"call",
"came",
"camp",
"card",
"care",
"case",
"cell",
"cent",
"city",
"coat",
"cold",
"come",
"cook",
"cool",
"copy",
"corn",
"cost",
"crop",
"dark",
"dead",
"deal",
"dear",
"deep",
"does",
"done",
"door",
"down",
"draw",
"drop",
"duck",
"each",
"ease",
"east",
"edge",
"else",
"even",
"ever",
"face",
"fact",
"fair",
"fall",
"farm",
"fast",
"fear",
"feed",
"feel",
"feet",
"fell",
"felt",
"fill",
"find",
"fine",
"fire",
"fish",
"five",
"flat",
"flow",
"food",
"foot",
"form",
"four",
"free",
"from",
"full",
"game",
"gave",
"girl",
"give",
"glad",
"gold",
"gone",
"good",
"gray",
"grew",
"grow",
"hair",
"half",
"hand",
"hard",
"have",
"head",
"hear",
"heat",
"held",
"help",
"here",
"high",
"hill",
"hold",
"hole",
"home",
"hope",
"hour",
"huge",
"hunt",
"idea",
"inch",
"iron",
"join",
"jump",
"just",
"keep",
"kept",
"kill",
"kind",
"king",
"knew",
"know",
"lady",
"lake",
"land",
"last",
"late",
"lead",
"left",
"less",
"life",
"lift",
"like",
"line",
"list",
"live",
"lone",
"long",
"look",
"lost",
"loud",
"love",
"made",
"main",
"make",
"many",
"mark",
"mass",
"mean",
"meat",
"meet",
"mile",
"milk",
"mind",
"mine",
"miss",
"moon",
"more",
"most",
"move",
"much",
"must",
"name",
"near",
"neck",
"need",
"next",
"nine",
"noon",
"nose",
"note",
"noun",
"once",
"only",
"open",
"over",
"page",
"pair",
"part",
"pass",
"past",
"path",
"pick",
"plan",
"play",
"poem",
"poor",
"port",
"pose",
"post",
"pull",
"push",
"race",
"rail",
"rain",
"read",
"real",
"rest",
"rich",
"ride",
"ring",
"rise",
"road",
"rock",
"roll",
"room",
"root",
"rope",
"rose",
"rule",
"safe",
"said",
"sail",
"salt",
"same",
"sand",
"save",
"seat",
"seed",
"seem",
"self",
"sell",
"send",
"sent",
"ship",
"shoe",
"shop",
"show",
"side",
"sign",
"sing",
"size",
"skin",
"slip",
"slow",
"snow",
"soft",
"soil",
"some",
"song",
"soon",
"spot",
"star",
"stay",
"step",
"stop",
"such",
"suit",
"sure",
"swim",
"tail",
"take",
"talk",
"tall",
"team",
"tell",
"term",
"test",
"than",
"that",
"them",
"then",
"they",
"thin",
"this",
"thus",
"time",
"tiny",
"tire",
"told",
"tone",
"took",
"tool",
"town",
"tree",
"trip",
"true",
"tube",
"turn",
"type",
"unit",
"vary",
"verb",
"very",
"view",
"wait",
"walk",
"wall",
"want",
"warm",
"wash",
"wave",
"wear",
"week",
"well",
"went",
"were",
"west",
"what",
"when",
"wide",
"wife",
"wild",
"will",
"wind",
"wing",
"wire",
"wish",
"with",
"wood",
"word",
"work",
"yard",
"year",
"your",
"about",
"above",
"after",
"again",
"agree",
"allow",
"among",
"anger",
"apple",
"basic",
"began",
"begin",
"black",
"block",
"blood",
"board",
"bread",
"break",
"bring",
"broad",
"broke",
"brown",
"build",
"carry",
"catch",
"cause",
"chair",
"chart",
"check",
"chick",
"chief",
"child",
"chord",
"claim",
"class",
"clean",
"clear",
"climb",
"clock",
"close",
"cloud",
"coast",
"color",
"could",
"count",
"cover",
"cross",
"crowd",
"dance",
"death",
"don't",
"dream",
"dress",
"drink",
"drive",
"early",
"earth",
"eight",
"enemy",
"enter",
"equal",
"event",
"every",
"exact",
"favor",
"field",
"fight",
"final",
"first",
"floor",
"force",
"found",
"fresh",
"front",
"fruit",
"glass",
"grand",
"grass",
"great",
"green",
"group",
"guess",
"guide",
"happy",
"heard",
"heart",
"heavy",
"horse",
"house",
"human",
"hurry",
"large",
"laugh",
"learn",
"least",
"leave",
"level",
"light",
"major",
"match",
"meant",
"metal",
"might",
"money",
"month",
"mount",
"mouth",
"music",
"never",
"night",
"noise",
"north",
"occur",
"ocean",
"offer",
"often",
"order",
"organ",
"other",
"paint",
"paper",
"party",
"piece",
"pitch",
"place",
"plain",
"plane",
"plant",
"point",
"pound",
"power",
"press",
"print",
"prove",
"quart",
"quick",
"quiet",
"quite",
"radio",
"raise",
"range",
"reach",
"ready",
"reply",
"right",
"river",
"round",
"scale",
"score",
"sense",
"serve",
"seven",
"shall",
"shape",
"share",
"sharp",
"sheet",
"shell",
"shine",
"shore",
"short",
"shout",
"sight",
"since",
"skill",
"slave",
"sleep",
"small",
"smell",
"smile",
"solve",
"sound",
"south",
"space",
"speak",
"speed",
"spell",
"spend",
"spoke",
"stand",
"start",
"state",
"stead",
"steam",
"steel",
"stick",
"still",
"stone",
"stood",
"store",
"story",
"study",
"sugar",
"table",
"teach",
"teeth",
"thank",
"their",
"there",
"these",
"thick",
"thing",
"think",
"third",
"those",
"three",
"throw",
"total",
"touch",
"track",
"trade",
"train",
"truck",
"under",
"until",
"usual",
"value",
"visit",
"voice",
"vowel",
"watch",
"water",
"wheel",
"where",
"which",
"while",
"white",
"whole",
"whose",
"woman",
"women",
"won't",
"world",
"would",
"write",
"wrong",
"wrote",
"young",
"afraid",
"always",
"animal",
"answer",
"appear",
"arrive",
"beauty",
"before",
"behind",
"better",
"bottom",
"bought",
"branch",
"bright",
"caught",
"center",
"chance",
"change",
"charge",
"choose",
"circle",
"clothe",
"colony",
"column",
"common",
"corner",
"cotton",
"course",
"crease",
"create",
"danger",
"decide",
"degree",
"depend",
"desert",
"design",
"differ",
"direct",
"divide",
"doctor",
"dollar",
"double",
"during",
"effect",
"either",
"energy",
"engine",
"enough",
"equate",
"except",
"excite",
"expect",
"family",
"famous",
"father",
"figure",
"finger",
"finish",
"flower",
"follow",
"forest",
"friend",
"garden",
"gather",
"gentle",
"govern",
"ground",
"happen",
"insect",
"invent",
"island",
"length",
"letter",
"liquid",
"listen",
"little",
"locate",
"magnet",
"market",
"master",
"matter",
"melody",
"method",
"middle",
"minute",
"modern",
"moment",
"mother",
"motion",
"nation",
"nature",
"notice",
"number",
"object",
"office",
"oxygen",
"parent",
"people",
"period",
"person",
"phrase",
"planet",
"please",
"plural",
"pretty",
"proper",
"rather",
"reason",
"record",
"region",
"repeat",
"result",
"school",
"search",
"season",
"second",
"select",
"settle",
"should",
"silent",
"silver",
"simple",
"single",
"sister",
"speech",
"spread",
"spring",
"square",
"stream",
"street",
"string",
"strong",
"sudden",
"suffix",
"summer",
"supply",
"symbol",
"system",
"though",
"toward",
"travel",
"twenty",
"valley",
"weight",
"window",
"winter",
"wonder",
"yellow",
"against",
"arrange",
"believe",
"between",
"brother",
"brought",
"capital",
"captain",
"century",
"certain",
"collect",
"company",
"compare",
"connect",
"contain",
"control",
"correct",
"country",
"current",
"decimal",
"develop",
"discuss",
"distant",
"element",
"evening",
"example",
"forward",
"general",
"history",
"hundred",
"imagine",
"include",
"instant",
"machine",
"measure",
"million",
"morning",
"natural",
"nothing",
"numeral",
"observe",
"operate",
"pattern",
"perhaps",
"picture",
"prepare",
"present",
"problem",
"process",
"produce",
"product",
"protect",
"provide",
"receive",
"require",
"science",
"section",
"segment",
"several",
"similar",
"soldier",
"special",
"station",
"strange",
"stretch",
"student",
"subject",
"success",
"suggest",
"support",
"surface",
"thought",
"through",
"trouble",
"village",
"weather",
"whether",
"written",
"children",
"complete",
"consider",
"continue",
"describe",
"division",
"electric",
"exercise",
"fraction",
"indicate",
"industry",
"interest",
"language",
"material",
"molecule",
"mountain",
"multiply",
"neighbor",
"opposite",
"original",
"populate",
"position",
"possible",
"practice",
"probable",
"property",
"question",
"quotient",
"remember",
"sentence",
"separate",
"shoulder",
"solution",
"straight",
"subtract",
"surprise",
"syllable",
"thousand",
"together",
"triangle",
"character",
"condition",
"consonant",
"continent",
"determine",
"difficult",
"necessary",
"paragraph",
"represent",
"substance"
];

var len = 10;

var shuffled = arr.sort(() => 0.5 - Math.random());

var selected = shuffled.slice(0, len).join(' ');

console.log(selected)

document.getElementById("mytext").innerHTML = selected;

var input = document.getElementById("myinput");

var first = true;

var start_time;

// Execute a function when the user releases a key on the keyboard
input.addEventListener("keyup", function(event) {
  if (first) {
    console.log("started");
    start_time = parseInt(performance.now());
    console.log(start_time);
    first = false;
  }
  document.getElementById("keycode").innerHTML=event.keycode;
  if (event.keycode === 13) {
    // Cancel the default action, if needed
    event.preventDefault();
    let user_string = input.value.trim();
    console.log(user_string);
    //let res = naive_check(user_string);
  //console.log(res);   
    console.log(selected.length, user_string.length);
    let diff = decent_check(selected, user_string);
    console.log(diff);
    var end_time = parseInt(performance.now());
    console.log(end_time);
    display((end_time-start_time)/1000, diff); //displays wpm and accuracy
  }
});

function display(raw_time, diff) {
  var wpm = parseInt(len/(raw_time/60));
  document.getElementById("wpm").innerHTML = 'raw wpm: ' + wpm + ' |';
  document.getElementById("acc").innerHTML = '| # of mistakes: ' + diff;
  var scaled = (wpm*((1-diff/len))).toFixed(2);
  var scaled = (wpm*((1-diff/len*0.7))).toFixed(2);
  document.getElementById("scaled").innerHTML = ((scaled >= 0) ? scaled : 0) + ' wpm';
}

function naive_check(str2) {
  let diff= "";
  let str1 = "type this text please";
  str2.split('').forEach(function(val, i){
    if (val != str1.charAt(i))
      diff += val ;         
  });
  return diff;
};

function decent_check(str1, str2) {
   const track = Array(str2.length + 1).fill(null).map(() =>
   Array(str1.length + 1).fill(null));
   for (let i = 0; i <= str1.length; i += 1) {
      track[0][i] = i;
   }
   for (let j = 0; j <= str2.length; j += 1) {
      track[j][0] = j;
   }
   for (let j = 1; j <= str2.length; j += 1) {
      for (let i = 1; i <= str1.length; i += 1) {
         const indicator = str1[i - 1] === str2[j - 1] ? 0 : 1;
         track[j][i] = Math.min(
            track[j][i - 1] + 1, // deletion
            track[j - 1][i] + 1, // insertion
            track[j - 1][i - 1] + indicator, // substitution
         );
      }
   }
   return track[str2.length][str1.length];
};
